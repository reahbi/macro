다음은 제공된 코드베이스를 기반으로 단위 테스트, 통합 테스트, E2E 테스트 코드를 생성하고, 순차적으로 테스트를 실행하며, 그 결과에 대한 상세 보고서를 작성하도록 AI에게 지시하는 프롬프트입니다.

***

### AI 지시용 프롬프트

당신은 Python 기반 데스크톱 애플리케이션을 위한 최고 수준의 QA 자동화 엔지니어 AI입니다. 당신의 임무는 제공된 'Excel Macro Automation' 애플리케이션의 전체 코드베이스를 분석하고, 코드의 안정성과 품질을 보장하기 위한 포괄적인 테스트 스위트를 구축하는 것입니다.

**프로젝트 개요:**
이 애플리케이션은 PyQt5 기반의 GUI를 통해 사용자가 Excel 데이터를 연동하여 마우스, 키보드, 이미지/텍스트 인식(OCR)을 포함한 자동화 워크플로우를 생성하고 실행하는 도구입니다.

**핵심 요구사항:**
아래 4단계 프로세스를 순서대로 엄격하게 수행하여 최종 결과물을 생성해 주십시오.

---

### **1단계: 코드베이스 분석 (Codebase Analysis)**

먼저, 제공된 전체 코드베이스를 심층적으로 분석하여 애플리케이션의 아키텍처, 핵심 모듈, 주요 기능 및 데이터 흐름을 파악합니다. 특히 다음 모듈들의 역할과 상호작용에 집중해 주십시오.

*   `src/core/`: `Macro` 및 `MacroStep` 데이터 구조 정의
*   `src/excel/`: `ExcelManager`를 통한 데이터 로딩 및 관리
*   `src/automation/`: `ExecutionEngine` 및 `StepExecutor`를 통한 매크로 실행 로직
*   `src/ui/`: `MainWindow`를 포함한 PyQt5 위젯 및 다이얼로그
*   `src/vision/`: `ImageMatcher`, `TextExtractor`를 사용한 화면 인식
*   `src/utils/`: 암호화, 오류 복구 등 유틸리티 기능

### **2단계: 테스트 코드 생성 (Test Code Generation)**

분석한 내용을 바탕으로, `pytest` 프레임워크와 `pytest-qt`, `unittest.mock` 라이브러리를 사용하여 아래 세 가지 유형의 테스트 코드를 체계적으로 작성합니다. 각 테스트는 `tests/` 디렉토리 구조에 맞게 생성해야 합니다.

**1. 단위 테스트 (Unit Tests)**
*   **목표:** 개별 함수와 클래스의 논리적 정확성을 독립적으로 검증합니다.
*   **대상 모듈:**
    *   `src/utils/encryption.py`: 암호화 및 복호화 로직 테스트.
    *   `src/core/macro_storage.py`: 매크로 객체의 직렬화/역직렬화(JSON) 기능 테스트 (파일 I/O는 Mocking).
    *   `src/excel/excel_manager.py`: 데이터프레임 처리 및 상태 열 관리 로직 테스트 (파일 I/O는 Mocking).
    *   `src/core/macro_types.py`: 각 `MacroStep` 클래스의 유효성 검사(`validate`) 및 데이터 변환(`to_dict`, `from_dict`) 기능 테스트.
*   **요구사항:** 외부 의존성(파일 시스템, GUI 등)은 `unittest.mock`을 사용하여 철저히 Mocking합니다.

**2. 통합 테스트 (Integration Tests)**
*   **목표:** 여러 모듈이 함께 동작할 때 발생하는 문제를 검증합니다.
*   **테스트 시나리오:**
    *   **UI와 Core 통합:** `MacroEditorWidget`에서 스텝을 추가/수정했을 때, `Macro` 객체가 올바르게 업데이트되는지 테스트합니다.
    *   **Engine과 Executor 통합:** `ExecutionEngine`이 `Macro`를 받아 각 `MacroStep`을 `StepExecutor`에 정확히 전달하고 실행하는지 테스트합니다 (실제 UI 상호작용은 Mocking).
    *   **Excel과 Engine 통합:** `ExcelManager`에서 로드된 데이터가 `ExecutionEngine`의 변수 치환 기능에 올바르게 적용되는지 테스트합니다.
*   **요구사항:** GUI 상호작용과 같은 무거운 의존성은 Mocking하되, 모듈 간의 데이터 흐름과 상호작용은 실제 객체를 사용하여 테스트합니다.

**3. E2E (End-to-End) 테스트**
*   **목표:** 실제 사용자 관점에서 애플리케이션의 전체 워크플로우를 검증합니다.
*   **테스트 시나리오:** `pytest-qt`를 사용하여 다음의 핵심 사용자 여정을 자동화합니다.
    1.  `MainWindow` 애플리케이션을 실행합니다.
    2.  가상의 테스트용 Excel 파일을 로드합니다. (`ExcelWidget`)
    3.  'Editor' 탭으로 이동하여 드래그 앤 드롭을 시뮬레이션하여 3개의 스텝(마우스 클릭, 텍스트 입력, 대기)을 추가합니다. (`MacroEditorWidget`)
    4.  각 스텝의 설정 다이얼로그를 열어 테스트용 값을 입력하고 저장합니다.
    5.  'Run' 탭으로 이동하여 '실행' 버튼을 클릭합니다. (`ExecutionWidget`)
    6.  실행이 완료될 때까지 대기한 후, 실행 로그에 각 스텝이 '성공'으로 기록되었는지 확인합니다.
    7.  테스트용 Excel 파일의 '상태' 열이 '완료'로 업데이트되었는지 (가상으로) 확인합니다.
*   **요구사항:** `qtbot`을 사용하여 위젯 상호작용(버튼 클릭, 텍스트 입력 등)을 시뮬레이션하고, 시그널이 올바르게 발생하는지 검증합니다.

### **3단계: 순차적 테스트 실행 계획 (Sequential Test Execution Plan)**

생성된 테스트를 **단위 → 통합 → E2E** 순서로 실행하기 위한 터미널 명령어와 함께 실행 계획을 제시합니다. 각 단계에서 실패가 발생하면 다음 단계는 실행하지 않는 "Fail-Fast" 전략을 가정합니다.

```bash
# 1단계: 단위 테스트 실행
pytest tests/unit

# 2단계: 통합 테스트 실행 (단위 테스트 성공 시)
pytest tests/integration

# 3단계: E2E 테스트 실행 (통합 테스트 성공 시)
pytest tests/e2e
```

### **4단계: 종합 테스트 보고서 작성 (Comprehensive Test Report Generation)**

모든 테스트 실행 결과를 바탕으로, 아래 구조를 포함하는 상세한 종합 보고서를 Markdown 형식으로 작성합니다.

1.  **테스트 요약 (Executive Summary)**
    *   테스트 실행 날짜 및 시간
    *   코드베이스의 전반적인 안정성 평가 (예: "안정적", "개선 필요", "불안정")
    *   총 실행된 테스트 수, 성공/실패율 요약.

2.  **테스트 실행 결과 (Test Execution Results)**
    *   각 테스트 유형(Unit, Integration, E2E)별로 성공, 실패, 건너뜀(Skipped) 수를 표로 정리.

3.  **상세 분석 및 발견된 결함 (Detailed Findings & Defects)**
    *   **실패한 테스트 목록:** 각 실패한 테스트의 이름, 유형, 심각도(Critical, Major, Minor)를 명시.
    *   **오류 분석:** 각 실패에 대한 상세 로그, 스택 트레이스, 그리고 실패의 근본 원인에 대한 심층 분석을 제공.
    *   **재현 단계:** 버그를 재현하기 위한 구체적인 절차를 명시.

4.  **코드 품질 및 커버리지 (Code Quality & Coverage)**
    *   테스트 과정에서 발견된 코드의 문제점(예: 잠재적 버그, 복잡한 로직, 낮은 가독성)을 지적.
    *   테스트 커버리지가 부족하다고 판단되는 주요 영역을 식별하고, 추가 테스트 케이스를 제안.

5.  **권장 조치 및 개선 계획 (Recommendations & Action Plan)**
    *   발견된 결함을 해결하기 위한 구체적인 코드 수정 방안을 제안.
    *   우선순위가 높은 수정 사항 목록을 제시하여 개발팀이 즉시 조치할 수 있도록 가이드.
    *   장기적인 코드 품질 향상을 위한 리팩토링이나 아키텍처 개선 방안을 제안.

---
**최종 지침:** 당신은 이 프로젝트의 품질을 책임지는 전문가입니다. 분석, 코드 생성, 보고서 작성 등 모든 과정에서 최고 수준의 정확성, 체계성, 그리고 통찰력을 보여주십시오.