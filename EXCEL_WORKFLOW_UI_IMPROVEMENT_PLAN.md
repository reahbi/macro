# Excel 기반 반복 작업 UI 개선 계획

## 📋 개요

현재 Excel Macro Automation 프로그램은 Excel 데이터를 활용한 반복 작업을 지원하는 구조를 갖추고 있지만, 사용자 입장에서 직관적이지 않고 복잡합니다. 이 문서는 병원, 사무실 등에서 Excel 데이터를 기반으로 반복 작업을 수행하는 사용자들이 쉽고 편리하게 사용할 수 있도록 UI를 개선하는 계획을 담고 있습니다.

## 🎯 핵심 목표

1. **직관성**: 프로그래밍 지식이 없는 사용자도 5분 안에 사용법을 익힐 수 있도록
2. **시각화**: Excel 데이터와 작업의 연결 관계를 한눈에 파악
3. **피드백**: 실시간 진행 상황과 결과를 명확하게 표시
4. **안정성**: 오류가 발생해도 전체 작업이 중단되지 않도록

## 🔍 현재 문제점 분석

### 1. 구조적 문제
- Loop 실행 기능이 구현되지 않음 (`_execute_loop` 메서드가 비어있음)
- Excel 데이터와 매크로 스텝의 연결이 명시적이지 않음
- 반복 구조를 만드는 과정이 복잡함

### 2. UX 문제
- Excel 탭과 Editor 탭이 분리되어 있어 작업 흐름이 끊김
- 어떤 Excel 행이 실행 중인지 시각적으로 표시되지 않음
- 전체 진행률과 개별 행의 상태를 한눈에 파악하기 어려움

## 💡 개선 방안

### 1. 새로운 "Excel 워크플로우" 모드 추가

#### 1.1 시작 화면 개선
```
┌─────────────────────────────────────────────────┐
│           작업 모드를 선택하세요                │
│                                                 │
│  ┌─────────────┐    ┌─────────────┐           │
│  │    Excel    │    │   일반      │           │
│  │  반복 작업  │    │   매크로    │           │
│  │             │    │             │           │
│  │ 📊 Excel    │    │ 🖱️ 단순    │           │
│  │ 데이터로    │    │ 클릭/입력   │           │
│  │ 반복 실행   │    │   작업      │           │
│  └─────────────┘    └─────────────┘           │
└─────────────────────────────────────────────────┘
```

#### 1.2 Excel 워크플로우 마법사
사용자가 "Excel 반복 작업"을 선택하면 단계별 마법사가 시작됩니다:

**Step 1: Excel 파일 선택**
```
📁 Excel 파일을 선택하세요
[파일 선택] C:\병원\환자명단.xlsx

✅ 100개의 데이터 행을 찾았습니다
```

**Step 2: 작업할 열 선택**
```
📊 작업에 사용할 열을 선택하세요:
☑ A열: 환자명
☑ B열: 주민번호
☐ C열: 진료과
☑ D열: 담당의사

선택한 열의 데이터가 자동으로 변수로 사용됩니다.
```

**Step 3: 반복 작업 정의**
```
🔄 각 행마다 수행할 작업을 정의하세요:

┌─ Excel 데이터 반복 ─────────────────────────┐
│ 📊 환자명단.xlsx (100행)                    │
│                                             │
│ [반복할 작업들]                             │
│ ├─ 1️⃣ 텍스트 찾기: {환자명}                │
│ ├─ 2️⃣ 더블클릭                             │
│ ├─ 3️⃣ 텍스트 입력: {주민번호}              │
│ └─ 4️⃣ 버튼 클릭: "저장"                    │
└─────────────────────────────────────────────┘

[+ 작업 추가] [테스트 실행] [완료]
```

### 2. 통합 편집기 UI

#### 2.1 Excel + Editor 통합 뷰
```
┌─────────────────────────────────────────────────────────────┐
│ [Excel 데이터]                    │ [작업 편집기]           │
│ ┌──┬────────┬──────────┬────┐   │ ┌─ 반복 작업 ────────┐ │
│ │  │환자명  │주민번호   │... │   │ │ 각 행마다:          │ │
│ ├──┼────────┼──────────┼────┤   │ ├─ 1.텍스트 찾기     │ │
│ │1 │김영희  │900101-2xx│... │   │ │   찾을 텍스트:      │ │
│ │2 │박철수  │850202-1xx│... │   │ │   {환자명} ← A열    │ │
│ │3 │이민호  │920303-1xx│... │   │ ├─ 2.더블클릭        │ │
│ └──┴────────┴──────────┴────┘   │ ├─ 3.텍스트 입력     │ │
│                                  │ │   입력할 텍스트:    │ │
│ 💡 드래그하여 변수로 사용 →      │ │   {주민번호} ← B열  │ │
│                                  │ └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2 드래그 앤 드롭 변수 바인딩
- Excel 열 헤더를 작업 설정으로 직접 드래그
- 자동으로 `{열이름}` 형태의 변수로 변환
- 실시간 데이터 미리보기 제공

### 3. 실행 화면 개선

#### 3.1 실시간 진행 상황 표시
```
┌─────────────────────────────────────────────────────────┐
│ 🏃 실행 중: 환자명단.xlsx 반복 작업                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 전체 진행률: ████████████░░░░░░░░ 45/100 (45%)        │
│                                                         │
│ 현재 작업: 김철수 (45번째 행)                          │
│ └─ ✅ 텍스트 찾기: "김철수" 완료                      │
│ └─ ✅ 더블클릭 완료                                   │
│ └─ 🔄 텍스트 입력 중...                               │
│                                                         │
│ ┌─ 상태 요약 ─────────────────────────────────────┐   │
│ │ ✅ 성공: 44    ❌ 실패: 0    ⏸️ 건너뜀: 1       │   │
│ │ ⏱️ 평균 시간: 2.3초/행   남은 시간: 약 2분       │   │
│ └─────────────────────────────────────────────────┘   │
│                                                         │
│ [일시정지] [중지] [실패한 항목만 재실행]               │
└─────────────────────────────────────────────────────────┘
```

#### 3.2 Excel 데이터 미리보기와 상태 표시
```
┌─ Excel 데이터 상태 ─────────────────────────────────────┐
│ │순번│환자명  │주민번호     │상태    │실행시간│메모  │
│ ├────┼────────┼────────────┼────────┼────────┼──────┤
│ │ 1  │김영희  │900101-2xxx │✅ 완료 │2.1초   │      │
│ │ 2  │박철수  │850202-1xxx │✅ 완료 │2.3초   │      │
│ │ 3  │이민호  │920303-1xxx │✅ 완료 │2.2초   │      │
│ │ 4  │최지원  │880404-2xxx │❌ 실패 │-       │찾기실패│
│ │ 45 │김철수  │750505-1xxx │🔄 진행중│1.5초   │      │
│ │ 46 │정하나  │960606-2xxx │⏳ 대기 │-       │      │
│ └────┴────────┴────────────┴────────┴────────┴──────┘
└─────────────────────────────────────────────────────────┘
```

### 4. 스마트 기능

#### 4.1 실행 모드
```
🎯 실행 옵션:
○ 전체 실행 - 모든 행 처리
○ 테스트 모드 - 첫 3개 행만 실행
○ 선택 실행 - 선택한 행만 실행
○ 실패 재실행 - 이전에 실패한 행만 실행
○ 이어서 실행 - 마지막 성공 지점부터 계속
```

#### 4.2 오류 처리 옵션
```
⚠️ 오류 발생 시:
○ 다음 행 계속 실행 (권장)
○ 사용자에게 물어보기
○ 전체 중지
○ N회 재시도 후 건너뛰기: [3]회
```

#### 4.3 실행 후 리포트
```
📊 작업 완료 리포트
─────────────────────────────
총 처리: 100행
성공: 98행 (98%)
실패: 2행 (2%)
총 소요시간: 3분 45초
평균 처리시간: 2.25초/행

실패 항목:
- 4번 행: 김철수 - "환자명을 찾을 수 없음"
- 67번 행: 박영희 - "저장 버튼 클릭 실패"

[실패 항목 재실행] [리포트 저장] [닫기]
```

### 5. 변수 시스템 개선

#### 5.1 자동 변수 인식
- Excel 열 이름이 자동으로 변수로 등록
- `{환자명}`, `{주민번호}` 형태로 사용
- 변수 자동완성 기능 제공

#### 5.2 변수 미리보기
```
변수 미리보기 (현재 행: 45)
┌─────────────────────────────┐
│ {환자명} = "김철수"         │
│ {주민번호} = "750505-1xxx"  │
│ {담당의사} = "이박사"       │
│ {현재행} = 45               │
│ {총행수} = 100              │
└─────────────────────────────┘
```

### 6. 템플릿 시스템

#### 6.1 자주 사용하는 작업 템플릿
```
📑 템플릿 선택:
├─ 🏥 병원
│  ├─ 환자 정보 입력
│  ├─ 검사 결과 등록
│  └─ 처방전 발행
├─ 🏢 사무실
│  ├─ 직원 정보 등록
│  ├─ 급여 입력
│  └─ 출퇴근 기록
└─ 🏫 학교
   ├─ 학생 성적 입력
   └─ 출석부 작성
```

## 🛠️ 구현 계획

### Phase 1: 핵심 기능 구현 (1-2주)
1. `_execute_loop` 메서드 구현
2. Excel 행 단위 반복 실행 로직
3. 실행 상태를 Excel 데이터에 반영

### Phase 2: UI 통합 (2-3주)
1. Excel 워크플로우 마법사 구현
2. 통합 편집기 UI 개발
3. 실시간 진행 상황 표시

### Phase 3: 고급 기능 (3-4주)
1. 드래그 앤 드롭 변수 바인딩
2. 스마트 실행 모드
3. 템플릿 시스템

### Phase 4: 안정화 및 최적화 (4-5주)
1. 오류 처리 개선
2. 성능 최적화
3. 사용자 피드백 반영

## 📈 기대 효과

1. **학습 시간 단축**: 30분 → 5분
2. **작업 설정 시간**: 20분 → 3분
3. **오류율 감소**: 실시간 피드백으로 문제 즉시 파악
4. **생산성 향상**: 100건 처리 시간 50% 단축

## 🔗 기술적 고려사항

1. **후방 호환성**: 기존 매크로 파일 지원
2. **성능**: 대용량 Excel 파일 처리 최적화
3. **확장성**: 플러그인 시스템으로 커스텀 작업 추가 가능
4. **접근성**: 키보드 단축키 및 스크린 리더 지원

---

이 계획을 통해 Excel 기반 반복 작업이 필요한 사용자들이 프로그래밍 지식 없이도 쉽고 빠르게 자동화를 구현할 수 있게 됩니다.