# 드래그 앤 드롭 변수 바인딩 테스트 가이드

## 구현된 기능

### 1. 변수 팔레트 위젯 (`src/ui/widgets/variable_palette.py`)
- Excel 열을 시각적으로 표현하는 드래그 가능한 변수 카드
- 변수 타입별 아이콘 및 색상 구분
  - 📝 텍스트 (초록색 배지)
  - 🔢 숫자 (파란색 배지)  
  - 📅 날짜 (노란색 배지)
- 변수 검색 기능
- 빠른 삽입 버튼 (현재행, 총행수, 오늘날짜)

### 2. 드롭 가능한 위젯들 (`src/ui/widgets/droppable_widgets.py`)
- **DroppableLineEdit**: 한 줄 입력 필드
- **DroppableTextEdit**: 여러 줄 입력 필드
- **DroppableConditionWidget**: 조건문 설정 위젯
- 드래그 호버 시 초록색 점선 테두리로 시각적 피드백
- 드롭 시 커서 위치에 정확히 변수 삽입

### 3. 향상된 다이얼로그
- **KeyboardTypeStepDialog**: 텍스트 입력 다이얼로그
  - 왼쪽: 변수 팔레트
  - 오른쪽: 드롭 가능한 텍스트 입력 영역
  - 사용된 변수 실시간 표시
- **EnhancedIfConditionDialog**: 조건문 다이얼로그
  - 변수 비교, 텍스트 존재, 사용자 정의 조건
  - 조건식 실시간 미리보기

## 테스트 방법

### 1. 단독 테스트 프로그램 실행
```bash
python test_drag_drop.py
```

### 2. 테스트 시나리오

#### 시나리오 1: 기본 드래그 앤 드롭
1. 왼쪽 변수 팔레트에서 변수 선택
2. 마우스로 드래그 시작
3. 오른쪽 입력 필드로 드래그
4. 드롭 시 변수가 `${변수명}` 형식으로 삽입 확인

#### 시나리오 2: 키보드 입력 다이얼로그
1. "키보드 입력 다이얼로그 테스트" 버튼 클릭
2. 변수를 텍스트 영역에 드래그 앤 드롭
3. 복수의 변수 사용하여 문장 작성
   예: "안녕하세요 ${이름}님, 혈압은 ${혈압}입니다."
4. "사용된 변수" 섹션에서 변수 목록 확인

#### 시나리오 3: 조건문 설정
1. 조건문 다이얼로그에서 변수 드래그
2. 왼쪽 필드: 변수 (예: ${혈압})
3. 중간: 연산자 선택 (>, <, ==, != 등)
4. 오른쪽 필드: 값 또는 다른 변수
5. 미리보기에서 조건식 확인

## 주요 특징

### 시각적 피드백
- 드래그 시작: 변수 카드가 반투명 픽스맵으로 표시
- 드롭 가능 영역: 초록색 점선 테두리
- 드롭 완료: 변수 즉시 삽입 및 하이라이트

### 변수 형식
- 기본 형식: `${변수명}`
- 기존 `{{변수명}}` 형식과 호환

### 사용성 개선
- 변수 팔레트 검색으로 빠른 변수 찾기
- 더블클릭으로도 변수 삽입 가능
- 사용된 변수 자동 추적 및 표시

## 향후 개선 사항
1. 변수 사용 위치 하이라이트
2. 변수 자동완성 기능
3. 변수 유효성 검사
4. 드래그 중 ESC 키로 취소

## 문제 해결

### 드래그가 작동하지 않는 경우
- Qt 이벤트 루프가 정상 작동하는지 확인
- 위젯의 setAcceptDrops(True) 설정 확인

### 변수가 삽입되지 않는 경우
- MIME 타입 'application/x-variable' 지원 확인
- 드롭 이벤트 핸들러 정상 작동 확인